<?php

// var_dump($calendario);
?>

<input type="button" value="pdf" onclick="converHTMLFileToPDF()">
<div class="sectExtraInt nop">
    <div class="maxW">

        <div>
            <img src="https://www.bogotamarket.com/images/site/calendario-header.jpg">
            <p>Estimado Daniel:<br>

                Desde el Bogotá Audiovisual Market, expresamos nuestro entusiasmo por darle la bienvenida a nuestro
                mercado
                y contar con su participación en las actividades que hemos preparado para esta nueva edición. <br>

                Hemos diseñado para usted la siguiente agenda con el fin de guiar su participación en el mercado y
                contar
                con su oportuna asistencia:
            </p>
        </div>

        <div class="listRegiones bg2">
            <main class="calendar" id="calendar">
                <table>
                    <tbody>
                        <tr>
                            <td>
                                <p><strong>Fecha</strong></p>
                            </td>
                            <td>
                                <p><strong>Cita / Evento</strong></p>
                            </td>
                            <td>
                                <p><strong>Hora de Inicio</strong></p>
                            </td>
                            <td>
                                <p><strong>Hora Final</strong></p>
                            </td>
                            <td>
                                <p><strong>Proyecto / Actividad</strong></p>
                            </td>
                            <td>
                                <p><strong>Lugar</strong></p>
                            </td>
                            <td>
                                <p><strong>Mesa</strong></p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><span style="font-weight: 400;">lunes, 8 de julio de 2024</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">INAUGURACI&Oacute;N</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">7:00 PM</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">10:00 PM</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">INAUGURACI&Oacute;N BAM 2024</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">Planetario de Bogot&aacute;</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">N/A</span></p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p><span style="font-weight: 400;">martes, 9 de julio de 2024</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">BAM TALKS:&nbsp;</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">10:30 AM</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">12:00</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">LA SUBJETIVIDAD: El poder del cine para contar la
                                        historia</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">SEDE EXPERIENCIA</span><span
                                        style="font-weight: 400;"><br /></span><span style="font-weight: 400;">(Gimnasio
                                        Moderno)</span></p>
                            </td>
                            <td>
                                <p><span style="font-weight: 400;">N/A</span></p>
                            </td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td rowspan="8">
                                <p><span style="font-weight: 400;">mi&eacute;rcoles, 10 de julio de 2024</span></p>
                            </td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td rowspan="3"><br />
                                <p><span style="font-weight: 400;">jueves, 11 de julio de 2024</span></p>
                            </td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                    </tbody>
                </table>
            </main>
        </div>
    </div>
</div>

<script>
    function readHTML() {
        // get the HTML source file path
        var path = document.getElementById("fileUpload").files[0];
        var contents;
        $("#error-message").html("");
        $("#fileUpload").css("border", "#a6a6a6 1px solid");
        if ($(path).length != 0) {
            var r = new FileReader();
            r.onload = function (e) {
                // read HTML file content
                contents = e.target.result;
                // show JavaScript PDF preview
                $(".preview").show();
                $("#temp-target").html(contents);

                $(".btn-preview").hide();
                $(".btn-generate").show();
            }
            r.readAsText(path);
        } else {
            $("#error-message").html("required.").show();
            $("#fileUpload").css("border", "#d96557 1px solid");
        }
    }

    function converHTMLFileToPDF() {
        const { jsPDF } = window.jspdf;
        var doc = new jsPDF('l', 'mm', [3100, 1200]);

        var pdfjs = document.querySelector('#calendar');

        console.log(pdfjs);
        // Convert HTML to PDF in JavaScript


        doc.html(pdfjs, {
            callback: function (doc) {
                doc.save("output.pdf");
            },
            x: 10,
            y: 10
        });

    }


</script>

<script>
    const jsArray = <?= $jsonArray ?>;


    const jscitas = jsArray;


    function ready() {

        jscitas.forEach(function (citasdias, indice) {
            // console.log(`El nombre en el índice ${indice} es ${citasdias}`);
            // console.log(citasdias.citas)
            let numerodia = indice + 1;

            citasdias.citas.forEach(function (cita) {
                // console.log({
                //     citas
                // });

                graficarCita(cita, numerodia)

            });
        });


        function graficarCita(cita, numerodia) {

            //console.log({cita})
            //console.log(numerodia)
            // console.log({
            //     cita,
            //     numerodia
            // });
            // console.log(
            //     cita.hor_ini_age,
            //     numerodia
            // );
            //console.log(cita.hor_ini_age)
            stringId = `celd-${cita.hor_ini_age}-${numerodia}`;
            // console.log(stringId)
            const celda = document.getElementById(stringId);

            if (celda) {
                duracion = ((cita.int_fin_age - cita.int_ini_age) * 150) / 60;
                margintop = 0;
                if (cita.min_ini_age > 0) {
                    margintop = ((cita.min_ini_age - 0) * 140) / 60;
                }

                //console.log( margintop,cita.min_ini_age )
                let plantilla = plantillaCita(cita.fecha, cita.not_age, cita.horario, duracion,
                    cita.not_age, margintop, cita.tit_age, cita)
                // console.log(plantilla)
                const textoNuevoElemento = document.createTextNode(plantilla);
                celda.innerHTML += plantilla;
            }

        }





        function plantillaCita(fecha, not_age, horario, duracion, nota, margintop, titulo, cita) {
            // console.log(duracion)
            // <p>${nota}</p>

            if (nota) {
                nota == `<p>${nota}</p>`;
            } else {

                if (titulo)
                    nota = titulo.slice(0, 19);
                else
                    nota = ''
            }
            // console.log(nota)
            // nota = nota.slice(0, 19);

            const jsonString = JSON.stringify(cita);
            // cita = json
            // let nota = `<p>${nota}</p>`;
            return `
        <div  onclick='mostrarpopup(${jsonString})'  class="task" style=" background: ${cita.color}; cursor:pointer; position: absolute; width: 10rem; margin-top: ${margintop}px;   height: ${duracion}px; ">
              <p>${nota}...</p>
             <p><time >${horario}</time> <time datetime="06:00"></time></p>
        </div>
        `
        }


    }

    document.addEventListener("DOMContentLoaded", ready);


    function mostrarpopup(cita) {

        // const citapop = JSON.parse(cita);
        // console.log(cita)
        let htmlparticipantes = '';
        cita.participantes.forEach(function (participante) {
            // console.log(participante.nombre)
            htmlparticipantes += `<div><div class="eapp-events-calendar-drop-down-item">  
                            <p  >${participante.nombre}</p>
                        </div></div>`;
            // console.log(htmlparticipantes)

        });



        let titulo = ''

        if (!titulo) {
            if (cita.not_age)
                titulo = cita.not_age
        } else {
            titulo = cita.tit_age
        }


        html = `
   <div class="eapp-events-calendar-popup-item-row">
    <div class="eapp-events-calendar-popup-time-component eapp-events-calendar-popup-item-time">
        <div class="eapp-events-calendar-popup-time-title">
            
            <div class="eapp-events-calendar-popup-time-titleText">Cuando</div>
        </div>
        <div class="eapp-events-calendar-popup-time-content">
            <div>${cita.horario}</div>
            
        </div>
    </div>
</div>
<div class="eapp-events-calendar-popup-location-component eapp-events-calendar-popup-item-location">
    <div class="eapp-events-calendar-popup-location-title">
       
        <div class="eapp-events-calendar-popup-location-titleText">Donde</div>
    </div>
    <div class="eapp-events-calendar-popup-location-content">
        <div>${cita.nom_lug}</div>
        <div class="eapp-events-calendar-drop-down-modal">
            <div class="eapp-events-calendar-drop-down-item">${cita.nom_ubi}</div>
        </div>
    </div>
</div>
<div class="eapp-events-calendar-organizer-component">
    <div class="eapp-events-calendar-organizer-title">
        
        <div class="eapp-events-calendar-organizer-titleText">Participantes:</div>
    </div>
    
    <div class="eapp-events-calendar-organizer-content">
        ${htmlparticipantes}
    </div>
    `;


        swal({
            title: titulo,
            html: html,
            animation: true,
            customClass: "animated tada",
        });


    }
</script>