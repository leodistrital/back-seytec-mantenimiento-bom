<?php

// var_dump($calendario);
?>

<input type="button" value="pdf" onclick="converHTMLFileToPDF()">
<div class="sectExtraInt nop">
    <div class="maxW">
        <div class="listRegiones bg2">
            <main class="calendar" id="calendar">
                <div class="calendar-week">
                    <div class="timezoneCell"></div>
                    <h2 class="calendarDay">
                        <a href="#" aria-label="Domingo 06 de Junio">
                            <time datetime="2021-06-06">
                                <span>LUNES</span>

                                <span>8</span>
                            </time>
                        </a>
                    </h2>
                    <h2 class="calendarDay">
                        <a href="#" aria-label="Lunes 07 de Junio">
                            <time datetime="2021-06-07">
                                <span>MARTES</span>

                                <span>9</span>
                            </time>
                        </a>
                    </h2>
                    <h2 class="calendarDay">
                        <a href="#" aria-label="Martes 08 de Junio">
                            <time datetime="2021-06-08">
                                <span>MIERCOLES</span>

                                <span>10</span>
                            </time>
                        </a>
                    </h2>
                    <h2 class="calendarDay">
                        <a href="#" aria-label="Miercoles 09 de Junio">
                            <time datetime="2021-06-09">
                                <span>JUEVES</span>

                                <span>11</span>
                            </time>
                        </a>
                    </h2>
                    <h2 class="calendarDay ">
                        <a href="#" aria-label="Jueves 10 de Junio">
                            <time datetime="2021-06-10">
                                <span>VIERNES</span>

                                <span>12</span>
                            </time>
                        </a>
                    </h2>
                    <h2 class="calendarDay">
                        <a href="#" aria-label="Viernes 11 de Junio">
                            <time datetime="2021-06-11">
                                <span>SABADO</span>

                                <span>13</span>
                            </time>
                        </a>
                    </h2>



                    <span class="hourCell">8AM</span>
                    <div tabindex="0" id="celd-8-1" class="taskCell">

                    </div>
                    <div tabindex="0" id="celd-8-2" class="taskCell">

                    </div>
                    <div tabindex="0" id="celd-8-3" class="taskCell">

                    </div>

                    <div class="taskCell" id="celd-8-4"></div>
                    <div class="taskCell" id="celd-8-5"></div>
                    <div class="taskCell" id="celd-8-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">9AM</span>
                    <div class="taskCell" id="celd-9-1"></div>
                    <div class="taskCell" id="celd-9-2"></div>
                    <div class="taskCell" id="celd-9-3"></div>
                    <div class="taskCell" id="celd-9-4"></div>
                    <div class="taskCell" id="celd-9-5"></div>
                    <div class="taskCell" id="celd-9-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">10AM</span>
                    <div class="taskCell" id="celd-10-1"></div>
                    <div class="taskCell" id="celd-10-2"></div>
                    <div class="taskCell" id="celd-10-3"></div>
                    <div class="taskCell" id="celd-10-4"></div>
                    <div class="taskCell" id="celd-10-5"></div>
                    <div class="taskCell" id="celd-10-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">11AM</span>
                    <div class="taskCell" id="celd-11-1"></div>
                    <div class="taskCell" id="celd-11-2"></div>
                    <div class="taskCell" id="celd-11-3"></div>
                    <div class="taskCell" id="celd-11-4"></div>
                    <div class="taskCell" id="celd-11-5"></div>
                    <div class="taskCell" id="celd-11-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">12PM</span>
                    <div class="taskCell" id="celd-12-1"></div>
                    <div class="taskCell" id="celd-12-2"></div>
                    <div class="taskCell" id="celd-12-3"></div>
                    <div class="taskCell" id="celd-12-4"></div>
                    <div class="taskCell" id="celd-12-5"></div>
                    <div class="taskCell" id="celd-12-6"></div>
                    <!-- <div class="taskCell">d</div> -->


                    <span class="hourCell">1PM</span>
                    <div class="taskCell" id="celd-13-1"></div>
                    <div class="taskCell" id="celd-13-2"></div>
                    <div class="taskCell" id="celd-13-3"></div>
                    <div class="taskCell" id="celd-13-4"></div>
                    <div class="taskCell" id="celd-13-5"></div>
                    <div class="taskCell" id="celd-13-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">2PM</span>
                    <div class="taskCell" id="celd-14-1"></div>
                    <div class="taskCell" id="celd-14-2"></div>
                    <div class="taskCell" id="celd-14-3"></div>
                    <div class="taskCell" id="celd-14-4"></div>
                    <div class="taskCell" id="celd-14-5"></div>
                    <div class="taskCell" id="celd-14-6">

                    </div>


                    <span class="hourCell">3PM</span>
                    <div class="taskCell" id="celd-15-1"></div>
                    <div class="taskCell" id="celd-15-2"></div>
                    <div class="taskCell" id="celd-15-3"></div>
                    <div class="taskCell" id="celd-15-4"></div>
                    <div class="taskCell" id="celd-15-5"></div>
                    <div class="taskCell" id="celd-15-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">4PM</span>
                    <div class="taskCell" id="celd-16-1"></div>
                    <div class="taskCell" id="celd-16-2"></div>
                    <div class="taskCell" id="celd-16-3"></div>
                    <div class="taskCell" id="celd-16-4"></div>
                    <div class="taskCell" id="celd-16-5"></div>
                    <div class="taskCell" id="celd-16-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">5PM</span>
                    <div class="taskCell" id="celd-17-1">

                    </div>
                    <div class="taskCell" id="celd-17-2"></div>
                    <div class="taskCell" id="celd-17-3"></div>
                    <div class="taskCell" id="celd-17-4"></div>
                    <div class="taskCell" id="celd-17-5">

                    </div>
                    <div class="taskCell" id="celd-17-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">6PM</span>
                    <div class="taskCell" id="celd-18-1"></div>
                    <div class="taskCell" id="celd-18-2"></div>
                    <div class="taskCell" id="celd-18-3"></div>
                    <div class="taskCell" id="celd-18-4"></div>
                    <div class="taskCell" id="celd-18-5"></div>
                    <div class="taskCell" id="celd-18-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">7PM</span>
                    <div class="taskCell" id="celd-19-1"></div>
                    <div class="taskCell" id="celd-19-2"></div>
                    <div class="taskCell" id="celd-19-3"></div>
                    <div class="taskCell" id="celd-19-4"></div>
                    <div class="taskCell" id="celd-19-5"></div>
                    <div class="taskCell" id="celd-19-6"></div>
                    <!-- <div class="taskCell">d</div> -->

                    <span class="hourCell">8PM</span>
                    <div class="taskCell" id="celd-20-1">

                    </div>
                    <div class="taskCell" id="celd-20-2"></div>
                    <div class="taskCell" id="celd-20-3"></div>
                    <div class="taskCell" id="celd-20-4"></div>
                    <div class="taskCell" id="celd-20-5"></div>
                    <div class="taskCell" id="celd-20-6"></div>
                </div>
            </main>
        </div>
    </div>
</div>

<script>
    function readHTML() {
        // get the HTML source file path
        var path = document.getElementById("fileUpload").files[0];
        var contents;
        $("#error-message").html("");
        $("#fileUpload").css("border", "#a6a6a6 1px solid");
        if ($(path).length != 0) {
            var r = new FileReader();
            r.onload = function (e) {
                // read HTML file content
                contents = e.target.result;
                // show JavaScript PDF preview
                $(".preview").show();
                $("#temp-target").html(contents);

                $(".btn-preview").hide();
                $(".btn-generate").show();
            }
            r.readAsText(path);
        } else {
            $("#error-message").html("required.").show();
            $("#fileUpload").css("border", "#d96557 1px solid");
        }
    }

    function converHTMLFileToPDF() {
        const { jsPDF } = window.jspdf;
        var doc = new jsPDF('l', 'mm', [3100, 1200]);

        var pdfjs = document.querySelector('#calendar');

        console.log(pdfjs);
        // Convert HTML to PDF in JavaScript


        doc.html(pdfjs, {
            callback: function (doc) {
                doc.save("output.pdf");
            },
            x: 10,
            y: 10
        });

    }


</script>

<script>
    const jsArray = <?= $jsonArray ?>;


    const jscitas = jsArray;


    function ready() {

        jscitas.forEach(function (citasdias, indice) {
            // console.log(`El nombre en el índice ${indice} es ${citasdias}`);
            // console.log(citasdias.citas)
            let numerodia = indice + 1;

            citasdias.citas.forEach(function (cita) {
                // console.log({
                //     citas
                // });

                graficarCita(cita, numerodia)

            });
        });


        function graficarCita(cita, numerodia) {

            //console.log({cita})
            //console.log(numerodia)
            // console.log({
            //     cita,
            //     numerodia
            // });
            // console.log(
            //     cita.hor_ini_age,
            //     numerodia
            // );
            //console.log(cita.hor_ini_age)
            stringId = `celd-${cita.hor_ini_age}-${numerodia}`;
            // console.log(stringId)
            const celda = document.getElementById(stringId);

            if (celda) {
                duracion = ((cita.int_fin_age - cita.int_ini_age) * 150) / 60;
                margintop = 0;
                if (cita.min_ini_age > 0) {
                    margintop = ((cita.min_ini_age - 0) * 140) / 60;
                }

                //console.log( margintop,cita.min_ini_age )
                let plantilla = plantillaCita(cita.fecha, cita.not_age, cita.horario, duracion,
                    cita.not_age, margintop, cita.tit_age, cita)
                // console.log(plantilla)
                const textoNuevoElemento = document.createTextNode(plantilla);
                celda.innerHTML += plantilla;
            }

        }





        function plantillaCita(fecha, not_age, horario, duracion, nota, margintop, titulo, cita) {
            // console.log(duracion)
            // <p>${nota}</p>

            if (nota) {
                nota == `<p>${nota}</p>`;
            } else {

                if (titulo)
                    nota = titulo.slice(0, 19);
                else
                    nota = ''
            }
            // console.log(nota)
            // nota = nota.slice(0, 19);

            const jsonString = JSON.stringify(cita);
            // cita = json
            // let nota = `<p>${nota}</p>`;
            return `
        <div  onclick='mostrarpopup(${jsonString})'  class="task" style=" background: ${cita.color}; cursor:pointer; position: absolute; width: 10rem; margin-top: ${margintop}px;   height: ${duracion}px; ">
              <p>${nota}...</p>
             <p><time >${horario}</time> <time datetime="06:00"></time></p>
        </div>
        `
        }


    }

    document.addEventListener("DOMContentLoaded", ready);


    function mostrarpopup(cita) {

        // const citapop = JSON.parse(cita);
        // console.log(cita)
        let htmlparticipantes = '';
        cita.participantes.forEach(function (participante) {
            // console.log(participante.nombre)
            htmlparticipantes += `<div><div class="eapp-events-calendar-drop-down-item">  
                            <p  >${participante.nombre}</p>
                        </div></div>`;
            // console.log(htmlparticipantes)

        });



        let titulo = ''

        if (!titulo) {
            if (cita.not_age)
                titulo = cita.not_age
        } else {
            titulo = cita.tit_age
        }


        html = `
   <div class="eapp-events-calendar-popup-item-row">
    <div class="eapp-events-calendar-popup-time-component eapp-events-calendar-popup-item-time">
        <div class="eapp-events-calendar-popup-time-title">
            
            <div class="eapp-events-calendar-popup-time-titleText">Cuando</div>
        </div>
        <div class="eapp-events-calendar-popup-time-content">
            <div>${cita.horario}</div>
            
        </div>
    </div>
</div>
<div class="eapp-events-calendar-popup-location-component eapp-events-calendar-popup-item-location">
    <div class="eapp-events-calendar-popup-location-title">
       
        <div class="eapp-events-calendar-popup-location-titleText">Donde</div>
    </div>
    <div class="eapp-events-calendar-popup-location-content">
        <div>${cita.nom_lug}</div>
        <div class="eapp-events-calendar-drop-down-modal">
            <div class="eapp-events-calendar-drop-down-item">${cita.nom_ubi}</div>
        </div>
    </div>
</div>
<div class="eapp-events-calendar-organizer-component">
    <div class="eapp-events-calendar-organizer-title">
        
        <div class="eapp-events-calendar-organizer-titleText">Participantes:</div>
    </div>
    
    <div class="eapp-events-calendar-organizer-content">
        ${htmlparticipantes}
    </div>
    `;


        swal({
            title: titulo,
            html: html,
            animation: true,
            customClass: "animated tada",
        });


    }
</script>